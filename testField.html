<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>test</title>
    <script src="./three.js"></script>
    <script src="./cannon.js"></script>
</head>
<body>
    <script>
        /**
         * 创建场景对象Scene
         */
        var scene = new THREE.Scene();
        var velocityP = new THREE.Vector3(1,1,1);
        let texture = new THREE.TextureLoader().load('./space.jpg');
        /**
         * 创建网格模型
         */
            // var geometry = new THREE.SphereGeometry(60, 40, 40); //创建一个球体几何对象
        var geometry = new THREE.OctahedronGeometry(20);
        console.log(geometry);
        //geometry.scale(-1, 1, 1);
        var material = new THREE.MeshLambertMaterial({
            //color: 0x0000ff
            side: THREE.BackSide,
            //map: texture
        }); //材质对象Material
        var mesh = new THREE.Mesh(geometry, material); //网格模型对象Mesh
        scene.add(mesh); //网格模型添加到场景中
        /**
         * 光源设置
         */
            //点光源
        var point = new THREE.PointLight(0xffffff);
        point.position.set(400, 200, 300); //点光源位置
        scene.add(point); //点光源添加到场景中
        //环境光
        var ambient = new THREE.AmbientLight(0x444444);
        scene.add(ambient);
        // console.log(scene)
        // console.log(scene.children)
        /**
         * 相机设置
         */
        var width = window.innerWidth; //窗口宽度
        var height = window.innerHeight; //窗口高度
        var k = width / height; //窗口宽高比
        var s = 200; //三维场景显示范围控制系数，系数越大，显示的范围越大
        //创建相机对象
        var camera = new THREE.OrthographicCamera(-s * k, s * k, s, -s, 1, 1000);
        camera.position.set(300, 300, 300); //设置相机位置
        camera.lookAt(scene.position); //设置相机方向(指向的场景对象)
        /**
         * 创建渲染器对象
         */
        var renderer = new THREE.WebGLRenderer();
        renderer.setSize(width, height);//设置渲染区域尺寸
        renderer.setClearColor(0xb9d3ff, 1); //设置背景颜色
        document.body.appendChild(renderer.domElement); //body元素中插入canvas对象
        //mesh.velocity.add(velocity);
        //执行渲染操作   指定场景、相机作为参数
        var world_new = new CANNON.World();
        world_new.gravity.set(0, 0, 0);
        //创建物理世界
        destinationPhysic_new = new CANNON.Body({ //创建一个刚体（物理世界的刚体数据）
            mass: 10, //刚体的质量，这里单位为kg
            position: new CANNON.Vec3(0,0,0), //刚体的位置，单位是米
            shape: new CANNON.Cylinder(10, 50, 100, 100),
            material: new CANNON.Material({friction: 0.05, restitution: 0}), //材质数据，里面规定了摩擦系数和弹性系数
        });
        world_new.addBody(destinationPhysic_new);
        //console.log(destinationPhysic_new);
        //destinationPhysic_new.velocity.copy(new THREE.Vector3(100, 100, 100));
        var axesHelper = new THREE.AxesHelper(300);
        scene.add(axesHelper);//辅助坐标系添加到场景中
        //destinationPhysic_new.quaternion.normalize();
        // var elu = new THREE.Vector3();
        // camera.getWorldDirection(elu);
        // var eluer = new THREE.Euler(elu.x, elu.y, elu.z)
        // var dir = new THREE.Quaternion();
        // dir.setFromEuler(eluer);

        // var dir = new THREE.Quaternion();
        // camera.getWorldQuaternion(dir);
        // var rot = new THREE.Quaternion();
        // rot.setFromAxisAngle(new THREE.Vector3(-1,0,0), Math.PI/2);
        // dir.multiply(rot);

        //destinationPhysic_new.quaternion.copy(dir);
        //destinationPhysic_new.quaternion.setFromAxisAngle(new THREE.Vector3(1,0,0), Math.PI/2);

        //console.log(dir);
        //console.log(destinationPhysic_new.quaternion);
        setInterval(function (){
            renderer.render(scene, camera);
            var timeStep = 1 / 100;
            world_new.step(timeStep);
            mesh.position.copy(destinationPhysic_new.position);
            mesh.quaternion.copy(destinationPhysic_new.quaternion);//更新终点
            //console.log(destinationPhysic_new.position, mesh.position);
        },10)
    </script>
</body>
</html>